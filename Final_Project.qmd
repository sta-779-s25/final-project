---
title: "Title"
author: "Authors"
format:
  pdf:
    fontsize: 12pt
editor: visual
execute: 
  echo: false
  message: false
  warning: false
abstract:
  This is an abstract
---

```{r}
#Libraries

library(causaldata)
library(dagitty)
library(ggdag)
library(tidyverse)
library(knitr)
```

#DAG

```{r}
# young_male_race is taking place of blackm_15_24 + whitem_15_24 + blackm_25_44 + whitem_25_44

castle_dag <- dagify(
  murder ~ young_male_race + poverty + popwt + robbery_gun_r + l_police + post + years_after_treat + robbery,
  
  post ~ homicide + robbery_gun_r + assault + burglary + larceny + motor + murder_lag + robbery,
  
  burglary ~ poverty + young_male_race,
  homicide ~ poverty + young_male_race,
  larceny ~ poverty + young_male_race,
  motor ~ poverty + young_male_race,
  robbery ~ poverty + young_male_race,
  assault ~ poverty + young_male_race,
  
  poverty ~ unemployrt + l_exp_subsidy + l_exp_pubwelfare + l_income,
  
  l_police ~ l_income,
  
  outcome = "murder",
  exposure = "post",
  labels = c(
    murder = "Murder",
    murder_lag = "Murder Lagged",
    unemployrt = "Unemployment",
    young_male_race = "Male Demo.",
    poverty = "Poverty",
    popwt = "Population",
    robbery_gun_r = "Armed Robbery Prop.",
    l_exp_subsidy = "Subsidy",
    l_exp_pubwelfare = "Welfare",
    l_police = "Police",
    post = "Castle Doctrine",
    years_after_treat = "Years Post Castle",
    
    homicide = "Homicides",
    robbery = "Robbery",
    assault = "Assaults",
    burglary = "Burglary",
    larceny = "Larceny",
    motor = "Auto Theft",
    l_income = "Income")
)


```

```{r, fig.height=10, fig.width=10}
ggdag(castle_dag, layout = "nicely", use_labels = "label", text = FALSE) +
  theme_dag()

```

```{r}
ggdag_adjustment_set(castle_dag, text_col = "black") +
  theme_dag()
adjustmentSets(castle_dag)

# use adjustment sets to build propensity score model

# check imbalance for variables not in DAG, adjust

# use weighting from propensity score in outcome model
    # add exposure + time to exposure + interaction
    # use g-comp technique

# use bootstrap to estimate standard error

# test effect for different years before/after - diff in diff
```

```{r}



```

```{r ref.label = knitr::all_labels()}
#| echo: true
#| eval: false
```
